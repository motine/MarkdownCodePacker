# Webpack

[Webpack](https://webpack.js.org/) builds all modules together which you then can either use via `import` somewhere (also import styles) or you can use a plugin that extracts the parts of it (e.g. [css](https://webpack.js.org/plugins/mini-css-extract-plugin/)).
Loaders are preprocessors.

- **Before you continue, consider finding a template** (e.g. [[202002232049]] Vue does provide project templates for webpack).
- When using webpack in Rails, consider removing the asset pipeline (for speed and less complexity).
- Also read [this article](https://prathamesh.tech/2020/03/25/webpacker-5-0-released/) before employing webpack in Rails

## Resources

- Nice Rails related [article](https://rossta.net/talks/webpack-survival-guide-rails.html)
- [Analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)
- https://medium.com/better-programming/the-battle-of-bundlers-6333a4e3eda9
- [[202003281059]] Javascript Modules & Bundler

## Junior Developer Exercise

### Instructions

_I gave these instructions to a junior developer once and then walked her through it..._

**Requirements**: transpile ES6 to ES5, autoprefixer, scss.

**Idea**: Use [webpack](https://webpack.js.org) to orchestrate the build (this is the current standard tool and is also integrated into Rails from version 6).

My steps for the setup would be to ...

1. ...read and learn about the [concepts of webpacker](https://webpack.js.org/concepts/)
2. ...install npm & webpack (see below)
3. ...create a webpack project by following [getting started](https://webpack.js.org/guides/getting-started/)
4. ...configure webpack for using sass
    - fly over [this](https://webpack.js.org/guides/asset-management/)) to understand the basics
    - install and configure: [sass-loader](https://webpack.js.org/loaders/sass-loader/) and [style-loader](https://webpack.js.org/loaders/style-loader/) and [css-loader](https://webpack.js.org/loaders/css-loader/)
    - we could probably leave out the style loader and not use import in your `index.js`. instead we could also extract the styles to another file with [mini-css-extract-plugin](https://webpack.js.org/plugins/mini-css-extract-plugin/)
5. ...install babel transpiler
    - [setup](https://webpack.js.org/loaders/babel-loader/)
    - optional [configure preset](https://babeljs.io/docs/en/babel-preset-env) (via browserlist)
6. ...install [autoprefixer](https://github.com/postcss/autoprefixer#webpack)

### Solution

```shell
docker run -it -p 9000:9000 -v(pwd):/app -w/app --rm node /bin/bash
npm init -y

npm install --save-dev webpack webpack-cli
# sass
npm install style-loader style-loader css-loader sass-loader node-sass --save-dev # optionally also add mini-css-extract-plugin if you want separate CSS files over importing via javascript
# babel
npm install --save-dev babel-loader @babel/core
npm install @babel/preset-env --save-dev
# autoprefixer
npm install postcss-loader autoprefixer --save-dev

npx webpack
npx webpack --watch
npx webpack-dev-server --port 9000 --host 0.0.0.0 # after `npm install --save-dev webpack-dev-server` and adding `devServer: { contentBase: './dist' },`
```

Results in this structure:

```
├── dist                # generated by webpacker
│   └── main.js         # generated by webpacker
├── index.html
├── package-lock.json   # generated by npm
├── package.json
├── postcss.config.js
├── src
│   ├── index.js
│   └── style.scss
└── webpack.config.js
```

Here are the files that I came up with:

`webpack.config.js`:

```javascript
const path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'main.js',
    path: path.resolve(__dirname, 'dist'),
  },
  module: {
    rules: [
      // style: creates `style` nodes from JS strings; css: translates CSS into CommonJS; sass: compiles Sass to CSS; postcss: allow postprocessing via autoprefixer
      { test: /\.scss$/i, use: [ 'style-loader',  'css-loader',  'sass-loader', 'postcss-loader'] },
      { test: /\.js$/, exclude: /node_modules/, loader: "babel-loader" }
    ],
  },
};
```

`postcss.config.js`:

```javascript
module.exports = {
  plugins: [
    require('autoprefixer')
  ]
}
```

<!-- README.md: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 -->
<!-- src/index.js:eNpNTjtvwjAQ3v0rDpY4UuQKGC0mVJUBtm6oA9gXsOTcRbaDhKr8917DQ2z33fcMXc+pQC63iNAm7qAyHxMy2eVcWaXagVwJTOBYxIRUdA2/CgRTLoARO/nBGjy74f80LuGx4Oed0JUP16q2Ymg5gb67AgSCw6JZNqsfSZuyWEojn3WoLYwifySbQIRp+73fScf8CyPP5krohGVI9FRZNSr1WnBifzPHvkfym0uIXr9tr+0fqGFRnw== -->
<!-- src/style.scss:eNpVjU0KwjAUhPfvFA+MOwOVQBfJBbxGmp8ajEl5SYUg3t1GxOJsv5n5mM+p8lK1uUnccnHx4Wow+oRFp8KLo+AVsIXCXVPjJsdMEg9CCAUg5RK1cdccrSN8AuKXz6SbghfAlG37gO6ReB6GI7LdqfbJv6KDaSvMlNdkf1rvjRnH/vwGlAc68w== -->
<!-- .babelrc:eNqr5lJQUCooSi1OLSlWslKIVnJISkxKzdGHCOmm5pUpxXLVAgDnKwxb -->
<!-- .browserslistrc:eNqzUzDQMzJV5crLL1FISU1MAQAe5wRS -->
<!-- .gitignore:eNrLy09Jjc/NTynNSS0GACBEBP8= -->
<!-- index.html:eNo1jcsNwzAMQ++dQs0A0QKqrx2gE7iW0KjIDzYv2b4x1JxIUHyi3HUrOHajCcucbhJCJJNl7ea0cMyWngb4+qEXcoWpcMS9y1dZ3psef6qV6juo1fIYRlZv4CX7On7bkITjGnRA55e+/QMcsS1i -->
<!-- package.json:eNplkbFuwyAURXd/BWLIVFOTRGmTqVLboXPHppEwvCgoLiAedRJF+fcCtmWrGTmHy316XAtCqBE/QDeECufoQwIteNTWJMZZxaqOKkDptQu96WCHMIJrPEYQAEPSIA+WbOm799ZviLEkCYIOpN5rUFtKZjMCZx0IpzF5y68d4XKyXqXnvr4zEb/hYP3Y12gJBvO4H5+vw2DtGzgwCozUMJnlpRY1NI/S+hzYPbEVm+fMKJ0HhFCCae+vxHIb/V6fIY+wW0fLB5vzZWOF6u1z3NVqsBJx6hZs3u8xLdwqKFEgZrVkfOKcxXCXrUafYv9LRxkuDUwtn9oT1E7IY1+65HemlI3uGxdsnb+luBV/hG6P2Q== -->
<!-- dist/main.js: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 -->

## Spike - Code Splitting

`webpack.config.js`:

```javascript
const path = require('path');

module.exports = {
  mode: 'development',
  entry: {
    page1: './src/page1.js',
    page2: './src/page2.js'
  },
  optimization: {
    splitChunks: { chunks: 'all', name: 'vendor' }
  },
  output: {
    filename: '[name].js', path: path.resolve(__dirname, 'dist'),
  },
};
```

<!-- .gitignore:eNrLy09Jjc/NTynNSS0GACBEBP8= -->
<!-- index.html:eNqzUXTxdw6JDHBVyCjJzbHjsoFRqYkpdja5qSWJCskZiUXFqSW2SqEhbroWSnY2+mBJLi6bpPyUSqDalMwyhcwUW6XEggKQLJCLKmgEF+WyKU4uyiwoUSguSrZVSsksLtEvSExPNdTLKgapgUja4VBlRFBVWWpeSn4RujJ9qDP1IV4DADN2Tdc= -->
<!-- src/components/Hello.vue:eNpFzrEOgjAYBOC9T3FhQRfZsXZ28SH+tD+BpNCm/BhN03e3SIzTLXdfTgvP0ZOwUYB20xPW07rempG9D42574GcsdDMKOWiu1oySnf/odKrTVMUo/gVQxI4HmjzglxNR0KnMzISy5YWHFKP9kHLkNi1KCiqVPCHVE7enrHaENkZdRmPD7DBh9RDwkwSrvhu9qZRH620Qbc= -->
<!-- src/page1.js:eNrLzC3ILypRCCtNVUgrys9VUCorTdVPySwu0Qcy9LKKlay5uPJSy0EKNKq5FBRSc6wUlJQTCwqUdIC8ktTcgpzEklSgmE1KZpldQWJ6qqGNPogJlK/VtOYCAOxfHZI= -->
<!-- src/page2.js:eNrLzC3ILypRCCtNVUgrys9VUCorTdVPySwu0Qcy9LKKlay5uPJSy0EKNKq5FBRSc6wUlJQTCwqMlHSA3JLU3IKcxJJUoKBNSmaZXUFieqqRjT6IqcRVq2nNBQDo+R2Z -->

will generate: `dist/page1.js`, `dist/page2.js`, `dist/vendor.js`

## Spike ...

...I remove the following spikes for brevity...
